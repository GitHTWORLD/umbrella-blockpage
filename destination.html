
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Access Blocked by HTWORLD IT Dept</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 40px; }
        .logo img { width: 120px; margin-bottom: 20px; }
        .warning-box { border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 60%; background-color: #f9f9f9; border-radius: 8px; }
        .warning-icon { color: #ff9900; font-size: 24px; margin-bottom: 10px; }
        .domain { font-weight: bold; font-size: 18px; margin: 10px 0; }
        .footer-links { margin-top: 20px; font-size: 14px; }
        .footer-links a { margin: 0 10px; color: #0073e6; text-decoration: none; }

        /* Discreet diagnostic footer */
        .diagnostic-container {
            margin: 8px auto 0;
            width: 60%;
            text-align: left;
            font-size: 12px;
            color: #777;
        }
        .diagnostic-toggle {
            cursor: pointer;
            color: #6a6a6a;
            text-decoration: underline;
        }
        .diagnostic-content {
            display: none;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px dashed #ddd;
            color: #666;
            word-break: break-word;
        }
        .kv { margin: 2px 0; }
        .kv .k { color: #888; }
        .kv .v { color: #333; }
    </style>
</head>
<body>
    <!-- Logo -->
    <div class="logo">
        <img src="https://raw.githubusercontent.com/GitHTWORLD/umbrella-blockpage/main/images/htworld-logo.jpg" alt="HTWORLD Logo">
    </div>

    <!-- Warning Box -->
    <div class="warning-box">
        <div class="warning-icon">⚠</div>
        <h2>This site is blocked due to Destination List Policy</h2>

        <!-- Domain placeholder -->
        <div class="domain" id="domain">[domain]</div>

        <!-- Your wording -->
        <p><span id="policy"> has blocked this website as it is not allowed based on the policies set forth by the HTWORLD IT Dept.</p>
        <p>
            If you believe this site to be blocked in error, submit a form below with your comments notating
            <span id="policy">HTWORLD IT Dept</span> blocked you, and why you believe it should be lifted.
        </p>
        <p>Your form will be reviewed by our technicians and an email will be sent when a determination has been made.</p>

        <!-- Links -->
        <div class="footer-links">
            <a href="https://yourformlink.com" target="_blank" rel="noopener">Submit Unblock Request</a> |
            <a href="https://your-report-link.example" target="_blank" rel="noopener">Report Incorrect Block</a> |
            <a href="#diagnostic" class="diagnostic-toggle" id="diagnostic-toggle">Diagnostic Info</a>
        </div>
    </div>

    <!-- Discreet Diagnostic Info (collapsible) -->
    <div class="diagnostic-container" id="diagnostic">
        <div class="diagnostic-content" id="diagnostic-content">
            <div class="kv"><span class="k">Client IP:</span> <span class="v" id="diag-client-ip">–</span></div>
            <div class="kv"><span class="k">Identity:</span> <span class="v" id="diag-identity">–</span></div>
            <div class="kv"><span class="k">Policy:</span> <span class="v" id="diag-policy">–</span></div>
            <div class="kv"><span class="k">Block Type:</span> <span class="v" id="diag-type">Destination List</span></div>
            <div class="kv"><span class="k">Category:</span> <span class="v" id="diag-category">–</span></div>
            <div class="kv"><span class="k">Raw URL:</span> <span class="v" id="diag-url">–</span></div>
            <div class="kv"><span class="k">Derived Domain:</span> <span class="v" id="diag-domain">–</span></div>
        </div>
    </div>

    <!-- Robust parameter parsing -->
    <script>
      // Helper: ROT13 decode
      function rot13(str) {
        return str.replace(/[a-zA-Z]/g, function(c){
          const base = c <= 'Z' ? 65 : 97;
          return String.fromCharCode(((c.charCodeAt(0) - base + 13) % 26) + base);
        });
      }

      // Helper: safely get hostname from a URL string
      function extractHostname(urlStr) {
        try {
          const decodedFirst = decodeURIComponent(urlStr);
          const looksRot13 = decodedFirst.startsWith('uggc://');
          const decoded = looksRot13 ? rot13(decodedFirst) : decodedFirst;
          const u = new URL(decoded);
          return u.hostname;
        } catch (e) {
          try {
            const decoded = decodeURIComponent(urlStr);
            return decoded
              .replace(/^https?:\/\//i, '')
              .replace(/^uggc:\/\//i, rot13('uggc://').replace(/^https?:\/\//i, ''))
              .split('/')[0];
          } catch (e2) {
            return '';
          }
        }
      }

      document.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);

        // DOMAIN: prefer ?domain=; else derive from ?url=
        let domain = params.get('domain');
        const rawUrl = params.get('url');
        if (!domain && rawUrl) {
          domain = extractHostname(rawUrl);
        }
        const domainEl = document.getElementById('domain');
        if (domainEl) domainEl.textContent = domain || '[domain]';

        // POLICY name
        const policy = params.get('policy') || 'HTWORLD IT Dept';
        const policyEl = document.getElementById('policy');
        if (policyEl) policyEl.textContent = policy;

        // DIAGNOSTIC fields
        const diagContent = document.getElementById('diagnostic-content');
        const setText = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val || '–'; };
        setText('diag-client-ip', params.get('client_ip'));
        setText('diag-identity', params.get('identity'));
        setText('diag-policy', policy);
        setText('diag-type', params.get('type') || 'domainlist');
        setText('diag-category', params.get('category'));
        setText('diag-url', rawUrl);
        setText('diag-domain', domain);

        // Toggle
        const toggleLink = document.getElementById('diagnostic-toggle');
        if (toggleLink && diagContent) {
          toggleLink.addEventListener('click', (e) => {
            e.preventDefault();
            diagContent.style.display = (diagContent.style.display === 'none' || diagContent.style.display === '') ? 'block' : 'none';
          });
        }
      });
    </script>
</body>
</html>
